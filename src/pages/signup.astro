---
export const prerender = false;

import { db, EmailSignup } from "astro:db";

if (Astro.request.method === "POST") {
  // Parse form data
  const formData = await Astro.request.formData();
  const email = formData.get("email");
  if (typeof email === "string") {
    // Insert form data into the EmailSignup table
    await db.insert(EmailSignup).values({ email });
  }
}

if (import.meta.env.DEV) {
  return Astro.redirect("/thank-you");
} else {
  return new Response(
    "Moved Permanently. Redirecting to https://getkontinue.com/thank-you",
    {
      status: 301,
      statusText: "Moved Permanently",
      headers: {
        "Content-Type": "text/plain; charset=utf-8",
        Location: "https://getkontinue.com/thank-you",
      },
    },
  );
}
---
